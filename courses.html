<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì „ìì±… - ga100</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="logo" onclick="window.location.href='index.html'" style="cursor:pointer">ga100</h1>
                <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>
            </div>
        </div>
    </header>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>ga100</h2>
            <button class="close-sidebar" onclick="toggleSidebar()">âœ•</button>
        </div>
        <div class="sidebar-section">
            <button class="auth-btn" id="authBtn" onclick="handleAuth()">ë¡œê·¸ì¸</button>
        </div>
        <div class="sidebar-section">
            <h3>ê°•ì˜</h3>
            <ul>
                <li><a href="courses.html">ëª¨ë“  ê°•ì˜ ë³´ê¸°</a></li>
            </ul>
        </div>
    </aside>

    <main class="main-content">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px;">
                <h2>ì „ìì±… ê°•ì˜</h2>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <select id="categoryFilter" onchange="filterCourses()" style="padding: 10px; border-radius: 6px; border: 1px solid var(--border);">
                        <option value="all">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                        <option value="ìŠ¹ì¸">ì• ë“œì„¼ìŠ¤ ìŠ¹ì¸</option>
                        <option value="ìˆ˜ìµí™”">ì• ë“œì„¼ìŠ¤ ìˆ˜ìµí™”</option>
                        <option value="ìµœì í™”">ìµœì í™”</option>
                        <option value="ê³ ê¸‰">ê³ ê¸‰ ì „ëµ</option>
                    </select>
                    <select id="priceFilter" onchange="filterCourses()" style="padding: 10px; border-radius: 6px; border: 1px solid var(--border);">
                        <option value="all">ì „ì²´ ê°€ê²©</option>
                        <option value="free">ë¬´ë£Œ</option>
                        <option value="paid">ìœ ë£Œ</option>
                    </select>
                </div>
            </div>

            <div class="course-grid" id="coursesGrid">
                <div style="text-align: center; padding: 40px; color: var(--gray);">ê°•ì˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>

            <div id="emptyState" style="display: none; text-align: center; padding: 60px 20px;">
                <div style="font-size: 64px; margin-bottom: 20px;">ğŸ“š</div>
                <h3 style="margin-bottom: 10px;">ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                <p style="color: var(--gray);">ê³§ ìƒˆë¡œìš´ ê°•ì˜ê°€ ì—…ë°ì´íŠ¸ë  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-links">
                <a href="my-home.html">ë§ˆì´í™ˆ</a>
                <a href="revenue.html">ìˆ˜ìµì¸ì¦</a>
                <a href="courses.html">ì „ìì±…</a>
                <a href="community.html">ì»¤ë®¤ë‹ˆí‹°</a>
            </div>
            <p class="copyright">Â© 2024 ga100. All rights reserved.</p>
        </div>
    </footer>

    <script type="module">
        import './firebase-config.js';

        let allCourses = [];
        let currentUser = null;

        document.addEventListener('DOMContentLoaded', async () => {
            await initAuth();
            await loadCourses();
        });

        async function initAuth() {
            const userData = sessionStorage.getItem('currentUser');
            const authBtn = document.getElementById('authBtn');
            
            if (userData) {
                currentUser = JSON.parse(userData);
                authBtn.textContent = 'ë¡œê·¸ì•„ì›ƒ';
                authBtn.onclick = logout;
            } else {
                authBtn.textContent = 'ë¡œê·¸ì¸';
                authBtn.onclick = () => window.location.href = 'login.html';
            }
        }

        window.toggleSidebar = function() {
            document.getElementById('sidebar').classList.toggle('active');
        };

        window.handleAuth = function() {
            if (currentUser) {
                logout();
            } else {
                window.location.href = 'login.html';
            }
        };

        async function logout() {
            try {
                await window.firebaseAuth.signOut();
                sessionStorage.removeItem('currentUser');
                window.location.reload();
            } catch (error) {
                console.error('Logout error:', error);
                alert('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function loadCourses() {
            try {
                allCourses = await window.firebaseDB.getCourses();
                filterCourses();
            } catch (error) {
                console.error('Error loading courses:', error);
                document.getElementById('coursesGrid').innerHTML = '<p style="text-align: center; color: var(--danger); padding: 40px;">ê°•ì˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }

        window.filterCourses = function() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const priceFilter = document.getElementById('priceFilter').value;

            let filtered = [...allCourses];

            if (categoryFilter !== 'all') {
                filtered = filtered.filter(c => c.category === categoryFilter);
            }

            if (priceFilter === 'free') {
                filtered = filtered.filter(c => c.price === 0);
            } else if (priceFilter === 'paid') {
                filtered = filtered.filter(c => c.price > 0);
            }

            displayCourses(filtered);
        };

        function displayCourses(courses) {
            const grid = document.getElementById('coursesGrid');
            const emptyState = document.getElementById('emptyState');

            if (courses.length === 0) {
                grid.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            grid.style.display = 'grid';
            emptyState.style.display = 'none';

            grid.innerHTML = courses.map(course => `
                <div class="course-card" onclick="window.location.href='course-detail.html?id=${course.id}'">
                    <div class="course-image">${course.image || 'ğŸ“–'}</div>
                    <div class="course-content">
                        <span class="course-category">${course.category}</span>
                        <h3>${course.title}</h3>
                        <p>${course.description}</p>
                        <div class="course-footer">
                            <span class="course-price">${course.price === 0 ? 'ë¬´ë£Œ' : course.price.toLocaleString() + 'ì›'}</span>
                            <span class="badge badge-success">ìˆ˜ê°• ê°€ëŠ¥</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
