<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì»¤ë®¤ë‹ˆí‹° - ga100</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="logo" onclick="window.location.href='index.html'" style="cursor:pointer">ga100</h1>
                <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>
            </div>
        </div>
    </header>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>ga100</h2>
            <button class="close-sidebar" onclick="toggleSidebar()">âœ•</button>
        </div>
        <div class="sidebar-section">
            <button class="auth-btn" id="authBtn" onclick="handleAuth()">ë¡œê·¸ì¸</button>
        </div>
    </aside>

    <main class="main-content">
        <div class="container">
            <h2 style="margin-bottom: 30px;">ì»¤ë®¤ë‹ˆí‹°</h2>

            <div class="admin-tabs">
                <button class="admin-tab active" onclick="switchTab('notice')">ê³µì§€ì‚¬í•­</button>
                <button class="admin-tab" onclick="switchTab('secret')">ì‹œí¬ë¦¿ 1:1 ì§ˆë¬¸</button>
                <button class="admin-tab" onclick="switchTab('tips')">ì œì ë…¸í•˜ìš°</button>
                <button class="admin-tab" onclick="switchTab('free')">ììœ ê²Œì‹œíŒ</button>
                <button class="admin-tab" onclick="switchTab('qna')">ì§ˆë¬¸/ë‹µë³€</button>
            </div>

            <!-- Notice -->
            <div class="admin-content active" id="notice-content">
                <div style="margin-bottom: 20px;" id="noticeWriteBtn"></div>
                <div id="noticeList"></div>
            </div>

            <!-- Secret Questions -->
            <div class="admin-content" id="secret-content">
                <div style="margin-bottom: 20px;" id="secretWriteBtn"></div>
                <div id="secretList"></div>
            </div>

            <!-- Tips -->
            <div class="admin-content" id="tips-content">
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="showPostForm('tips')" id="tipsBtn">ë…¸í•˜ìš° ì‘ì„±</button>
                </div>
                <div id="tipsList"></div>
            </div>

            <!-- Free Board -->
            <div class="admin-content" id="free-content">
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="showPostForm('free')" id="freeBtn">ê¸€ ì‘ì„±</button>
                </div>
                <div id="freeList"></div>
            </div>

            <!-- QnA -->
            <div class="admin-content" id="qna-content">
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="showPostForm('qna')" id="qnaBtn">ì§ˆë¬¸ ì‘ì„±</button>
                </div>
                <div id="qnaList"></div>
            </div>
        </div>
    </main>

    <!-- Post Form Modal -->
    <div class="modal" id="postModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">ê¸€ ì‘ì„±</h3>
                <button class="modal-close" onclick="closePostModal()">âœ•</button>
            </div>
            <form onsubmit="submitPost(event)">
                <div class="form-group">
                    <label>ì œëª©</label>
                    <input type="text" id="postTitle" required>
                </div>
                <div class="form-group">
                    <label>ë‚´ìš©</label>
                    <textarea id="postContent" required style="min-height: 200px;"></textarea>
                </div>
                <div id="postAlert"></div>
                <button type="submit" class="btn btn-primary">ë“±ë¡</button>
            </form>
        </div>
    </div>

    <!-- Post Detail Modal -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ê²Œì‹œê¸€</h3>
                <button class="modal-close" onclick="closeDetailModal()">âœ•</button>
            </div>
            <div id="postDetail"></div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-links">
                <a href="my-home.html">ë§ˆì´í™ˆ</a>
                <a href="revenue.html">ìˆ˜ìµì¸ì¦</a>
                <a href="courses.html">ì „ìì±…</a>
                <a href="community.html">ì»¤ë®¤ë‹ˆí‹°</a>
            </div>
            <p class="copyright">Â© 2024 ga100. All rights reserved.</p>
        </div>
    </footer>

    <script>
        let currentUser = JSON.parse(localStorage.getItem('currentUser'));
        let currentPostType = '';
        const urlParams = new URLSearchParams(window.location.search);
        const initialTab = urlParams.get('tab') || 'notice';

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        function handleAuth() {
            if (currentUser) {
                localStorage.removeItem('currentUser');
                window.location.reload();
            } else {
                window.location.href = 'login.html';
            }
        }

        function initAuth() {
            const authBtn = document.getElementById('authBtn');
            
            if (currentUser) {
                authBtn.textContent = 'ë¡œê·¸ì•„ì›ƒ';
                initWriteButtons();
            } else {
                authBtn.textContent = 'ë¡œê·¸ì¸';
                ['tipsBtn', 'freeBtn', 'qnaBtn'].forEach(id => {
                    const btn = document.getElementById(id);
                    if (btn) btn.disabled = true;
                });
            }
        }

        function initWriteButtons() {
            // Notice write button (admin/manager only)
            if (currentUser && (currentUser.role === 'admin' || currentUser.role === 'manager')) {
                document.getElementById('noticeWriteBtn').innerHTML = '<button class="btn btn-primary" onclick="showPostForm(\'notice\')">ê³µì§€ ì‘ì„±</button>';
            }

            // Secret question button
            const secretQuestions = currentUser?.secretQuestions || 0;
            document.getElementById('secretWriteBtn').innerHTML = `
                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="showPostForm('secret')" ${secretQuestions === 0 ? 'disabled' : ''}>ì‹œí¬ë¦¿ ì§ˆë¬¸í•˜ê¸°</button>
                    <span style="color: var(--gray);">ë³´ìœ  ì§ˆë¬¸ê¶Œ: ${secretQuestions}ê°œ</span>
                </div>
            `;
        }

        function switchTab(tab) {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.admin-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + '-content').classList.add('active');
            
            loadPosts(tab);
        }

        function showPostForm(type) {
            if (!currentUser) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = 'login.html';
                return;
            }

            if (type === 'notice' && currentUser.role !== 'admin' && currentUser.role !== 'manager') {
                alert('ê³µì§€ëŠ” ê´€ë¦¬ìë§Œ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            if (type === 'secret' && (currentUser.secretQuestions || 0) === 0) {
                alert('ì‹œí¬ë¦¿ ì§ˆë¬¸ê¶Œì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            currentPostType = type;
            const titles = {
                'notice': 'ê³µì§€ ì‘ì„±',
                'secret': 'ì‹œí¬ë¦¿ ì§ˆë¬¸ ì‘ì„±',
                'tips': 'ë…¸í•˜ìš° ì‘ì„±',
                'free': 'ììœ ê²Œì‹œíŒ ê¸€ ì‘ì„±',
                'qna': 'ì§ˆë¬¸ ì‘ì„±'
            };
            document.getElementById('modalTitle').textContent = titles[type];
            document.getElementById('postModal').classList.add('active');
        }

        function closePostModal() {
            document.getElementById('postModal').classList.remove('active');
            document.getElementById('postTitle').value = '';
            document.getElementById('postContent').value = '';
            document.getElementById('postAlert').innerHTML = '';
        }

        function submitPost(e) {
            e.preventDefault();
            
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('postContent').value.trim();

            let posts = JSON.parse(localStorage.getItem('posts') || '[]');
            
            const newPost = {
                id: Date.now(),
                type: currentPostType,
                title: title,
                content: content,
                author: currentUser.nickname,
                createdAt: new Date().toISOString(),
                comments: []
            };

            posts.unshift(newPost);
            localStorage.setItem('posts', JSON.stringify(posts));

            // Deduct secret question if type is secret
            if (currentPostType === 'secret') {
                let users = JSON.parse(localStorage.getItem('users') || '[]');
                const userIndex = users.findIndex(u => u.nickname === currentUser.nickname);
                users[userIndex].secretQuestions--;
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('currentUser', JSON.stringify(users[userIndex]));
                currentUser = users[userIndex];
            }

            // Add points for community posts
            if (currentPostType === 'tips' || currentPostType === 'free') {
                let users = JSON.parse(localStorage.getItem('users') || '[]');
                const userIndex = users.findIndex(u => u.nickname === currentUser.nickname);
                users[userIndex].secretQuestions = (users[userIndex].secretQuestions || 0) + 2;
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('currentUser', JSON.stringify(users[userIndex]));
                currentUser = users[userIndex];
            }

            alert('ê²Œì‹œê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
            closePostModal();
            loadPosts(currentPostType);
            initWriteButtons();
        }

        function loadPosts(type) {
            const posts = JSON.parse(localStorage.getItem('posts') || '[]');
            const filteredPosts = posts.filter(p => p.type === type);
            const listId = type + 'List';
            const list = document.getElementById(listId);

            if (filteredPosts.length === 0) {
                list.innerHTML = '<p style="color: var(--gray); padding: 40px; text-align: center;">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            list.innerHTML = filteredPosts.map(post => `
                <div class="admin-panel" style="cursor: pointer; margin-bottom: 15px;" onclick="showPostDetail(${post.id})">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                        <h4 style="margin: 0;">${post.title}</h4>
                        <span style="color: var(--gray); font-size: 14px; white-space: nowrap; margin-left: 10px;">${new Date(post.createdAt).toLocaleDateString('ko-KR')}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: var(--gray); font-size: 14px;">${post.author}</span>
                        <span style="color: var(--gray); font-size: 14px;">ğŸ’¬ ${post.comments.length}</span>
                    </div>
                </div>
            `).join('');
        }

        function showPostDetail(postId) {
            const posts = JSON.parse(localStorage.getItem('posts') || '[]');
            const post = posts.find(p => p.id === postId);

            if (!post) return;

            const detailHtml = `
                <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--border);">
                    <h3 style="margin-bottom: 10px;">${post.title}</h3>
                    <div style="display: flex; gap: 15px; color: var(--gray); font-size: 14px; margin-bottom: 15px;">
                        <span>${post.author}</span>
                        <span>${new Date(post.createdAt).toLocaleString('ko-KR')}</span>
                    </div>
                    <p style="line-height: 1.8; white-space: pre-wrap;">${post.content}</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px;">ëŒ“ê¸€ ${post.comments.length}ê°œ</h4>
                    <div id="commentsList">
                        ${post.comments.map(comment => `
                            <div style="background: var(--light-gray); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <strong>${comment.author}</strong>
                                    <span style="color: var(--gray); font-size: 12px;">${new Date(comment.createdAt).toLocaleString('ko-KR')}</span>
                                </div>
                                <p style="margin: 0;">${comment.content}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                ${currentUser ? `
                    <form onsubmit="addComment(event, ${postId})">
                        <div class="form-group">
                            <label>ëŒ“ê¸€ ì‘ì„±</label>
                            <textarea id="commentContent" required style="min-height: 80px;"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">ëŒ“ê¸€ ë“±ë¡</button>
                    </form>
                ` : '<p style="color: var(--gray); text-align: center;">ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>'}
            `;

            document.getElementById('postDetail').innerHTML = detailHtml;
            document.getElementById('detailModal').classList.add('active');
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('active');
        }

        function addComment(e, postId) {
            e.preventDefault();
            
            const content = document.getElementById('commentContent').value.trim();
            if (!content) return;

            let posts = JSON.parse(localStorage.getItem('posts') || '[]');
            const postIndex = posts.findIndex(p => p.id === postId);
            
            posts[postIndex].comments.push({
                id: Date.now(),
                author: currentUser.nickname,
                content: content,
                createdAt: new Date().toISOString()
            });

            localStorage.setItem('posts', JSON.stringify(posts));

            // Add secret question for comment
            let users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.nickname === currentUser.nickname);
            users[userIndex].secretQuestions = (users[userIndex].secretQuestions || 0) + 1;
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('currentUser', JSON.stringify(users[userIndex]));
            currentUser = users[userIndex];

            alert('ëŒ“ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! ì‹œí¬ë¦¿ ì§ˆë¬¸ê¶Œ 1ê°œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤.');
            showPostDetail(postId);
            initWriteButtons();
        }

        // Initialize
        initAuth();
        
        // Set initial tab
        document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.admin-content').forEach(c => c.classList.remove('active'));
        
        const tabButtons = ['notice', 'secret', 'tips', 'free', 'qna'];
        const tabIndex = tabButtons.indexOf(initialTab);
        if (tabIndex >= 0) {
            document.querySelectorAll('.admin-tab')[tabIndex].classList.add('active');
            document.getElementById(initialTab + '-content').classList.add('active');
            loadPosts(initialTab);
        }

        // Load all posts
        tabButtons.forEach(tab => loadPosts(tab));
    </script>
</body>
  </html>
