<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€ - ga100</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="logo" onclick="window.location.href='index.html'" style="cursor:pointer">ga100</h1>
                <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>
                <div class="header-right">
                    <span style="color: var(--primary); font-weight: bold; margin-right: 15px;">ğŸ‘‘ ê´€ë¦¬ì</span>
                </div>
            </div>
        </div>
    </header>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>ga100</h2>
            <button class="close-sidebar" onclick="toggleSidebar()">âœ•</button>
        </div>
        <div class="sidebar-section">
            <button class="auth-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </aside>

    <main class="main-content">
        <div class="container">
            <h2 style="margin-bottom: 30px;">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h2>

            <div class="admin-tabs">
                <button class="admin-tab active" onclick="switchAdminTab('sales')">ì¼ì¼ ë§¤ì¶œ</button>
                <button class="admin-tab" onclick="switchAdminTab('courses')">ê°•ì˜ ê´€ë¦¬</button>
                <button class="admin-tab" onclick="switchAdminTab('users')">íšŒì› ê´€ë¦¬</button>
                <button class="admin-tab" onclick="switchAdminTab('blacklist')">ë¸”ë™ë¦¬ìŠ¤íŠ¸</button>
                <button class="admin-tab" onclick="switchAdminTab('stats')">í†µê³„</button>
            </div>

            <!-- Daily Sales -->
            <div class="admin-content active" id="sales-content">
                <div class="admin-panel">
                    <h3 style="margin-bottom: 20px;">ì¼ì¼ ë§¤ì¶œ í˜„í™©</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 12px; color: white;">
                            <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px;">ì˜¤ëŠ˜ ë§¤ì¶œ</div>
                            <div style="font-size: 32px; font-weight: bold;" id="todaySales">0ì›</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 20px; border-radius: 12px; color: white;">
                            <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px;">ì´ë²ˆ ë‹¬ ë§¤ì¶œ</div>
                            <div style="font-size: 32px; font-weight: bold;" id="monthSales">0ì›</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 20px; border-radius: 12px; color: white;">
                            <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px;">ì˜¤ëŠ˜ íŒë§¤ ê±´ìˆ˜</div>
                            <div style="font-size: 32px; font-weight: bold;" id="todayCount">0ê±´</div>
                        </div>
                    </div>

                    <h4 style="margin-bottom: 15px;">ìµœê·¼ ê±°ë˜ ë‚´ì—­</h4>
                    <div id="salesList">
                        <div style="text-align: center; padding: 40px; color: var(--gray);">ê±°ë˜ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    </div>
                </div>
            </div>

            <!-- Course Management -->
            <div class="admin-content" id="courses-content">
                <div class="admin-panel">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                        <h3>ê°•ì˜ ëª©ë¡</h3>
                        <button class="btn btn-primary" onclick="showCourseForm()">ê°•ì˜ ì¶”ê°€</button>
                    </div>
                    <div id="coursesList">
                        <div style="text-align: center; padding: 40px; color: var(--gray);">ê°•ì˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    </div>
                </div>
            </div>

            <!-- User Management -->
            <div class="admin-content" id="users-content">
                <div class="admin-panel">
                    <h3 style="margin-bottom: 20px;">íšŒì› ëª©ë¡</h3>
                    <div id="usersList">
                        <div style="text-align: center; padding: 40px; color: var(--gray);">íšŒì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    </div>
                </div>
            </div>

            <!-- Blacklist -->
            <div class="admin-content" id="blacklist-content">
                <div class="admin-panel">
                    <h3 style="margin-bottom: 20px;">ë¸”ë™ë¦¬ìŠ¤íŠ¸</h3>
                    <div id="blacklistList">
                        <div style="text-align: center; padding: 40px; color: var(--gray);">ë¸”ë™ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    </div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="admin-content" id="stats-content">
                <div class="admin-panel">
                    <h3 style="margin-bottom: 20px;">í†µê³„</h3>
                    <div id="statsContainer">
                        <div style="text-align: center; padding: 40px; color: var(--gray);">í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Course Form Modal -->
    <div class="modal" id="courseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="courseModalTitle">ê°•ì˜ ì¶”ê°€</h3>
                <button class="modal-close" onclick="closeCourseModal()">âœ•</button>
            </div>
            <form onsubmit="submitCourse(event)">
                <div id="courseAlert"></div>
                <div class="form-group">
                    <label>ê°•ì˜ ì œëª©</label>
                    <input type="text" id="courseTitle" required>
                </div>
                <div class="form-group">
                    <label>ì„¤ëª…</label>
                    <textarea id="courseDescription" required style="min-height: 80px;"></textarea>
                </div>
                <div class="form-group">
                    <label>ê°€ê²© (ì›, 0ì€ ë¬´ë£Œ)</label>
                    <input type="number" id="coursePrice" required min="0">
                </div>
                <div class="form-group">
                    <label>ì¹´í…Œê³ ë¦¬</label>
                    <select id="courseCategory" required>
                        <option value="ìŠ¹ì¸">ìŠ¹ì¸</option>
                        <option value="ìˆ˜ìµí™”">ìˆ˜ìµí™”</option>
                        <option value="ìµœì í™”">ìµœì í™”</option>
                        <option value="ê³ ê¸‰">ê³ ê¸‰</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì´ëª¨ì§€ ì•„ì´ì½˜</label>
                    <input type="text" id="courseImage" placeholder="ğŸ“–" maxlength="2">
                </div>
                <div class="form-group">
                    <label>ê°•ì˜ ë‚´ìš©</label>
                    <textarea id="courseContent" required style="min-height: 200px;" placeholder="ê°•ì˜ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                </div>
                <input type="hidden" id="courseId">
                <button type="submit" class="btn btn-primary" id="courseSaveBtn">ì €ì¥</button>
            </form>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p class="copyright">Â© 2024 ga100. All rights reserved.</p>
        </div>
    </footer>

    <script type="module">
        import './firebase-config.js';

        let currentUser = null;
        let editingCourseId = null;

        // Check admin auth
        document.addEventListener('DOMContentLoaded', async () => {
            const userData = sessionStorage.getItem('currentUser');
            if (!userData) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = 'login.html';
                return;
            }

            currentUser = JSON.parse(userData);
            if (currentUser.role !== 'admin') {
                alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = 'index.html';
                return;
            }

            await loadSales();
        });

        window.toggleSidebar = function() {
            document.getElementById('sidebar').classList.toggle('active');
        };

        async function logout() {
            try {
                await window.firebaseAuth.signOut();
                sessionStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Logout error:', error);
                alert('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        window.logout = logout;

        window.switchAdminTab = async function(tab) {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.admin-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + '-content').classList.add('active');
            
            if (tab === 'sales') await loadSales();
            if (tab === 'courses') await loadCourses();
            if (tab === 'users') await loadUsers();
            if (tab === 'blacklist') await loadBlacklist();
            if (tab === 'stats') await loadStats();
        };

        async function loadSales() {
            try {
                const allSales = await window.firebaseDB.getSales();
                const todaySales = await window.firebaseDB.getTodaySales();

                // Calculate today's total
                const todayTotal = todaySales.reduce((sum, sale) => sum + (sale.amount || 0), 0);
                document.getElementById('todaySales').textContent = todayTotal.toLocaleString() + 'ì›';
                document.getElementById('todayCount').textContent = todaySales.length + 'ê±´';

                // Calculate this month's total
                const now = new Date();
                const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
                const monthSales = allSales.filter(sale => {
                    const saleDate = sale.createdAt?.toDate ? sale.createdAt.toDate() : new Date(sale.createdAt);
                    return saleDate >= monthStart;
                });
                const monthTotal = monthSales.reduce((sum, sale) => sum + (sale.amount || 0), 0);
                document.getElementById('monthSales').textContent = monthTotal.toLocaleString() + 'ì›';

                // Display sales list
                const salesList = document.getElementById('salesList');
                if (allSales.length === 0) {
                    salesList.innerHTML = '<p style="color: var(--gray); padding: 20px; text-align: center;">ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                salesList.innerHTML = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ë‚ ì§œ</th>
                                <th>êµ¬ë§¤ì</th>
                                <th>ê°•ì˜</th>
                                <th>ê¸ˆì•¡</th>
                                <th>ìƒíƒœ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${allSales.slice(0, 20).map(sale => {
                                const saleDate = sale.createdAt?.toDate ? sale.createdAt.toDate() : new Date(sale.createdAt);
                                return `
                                    <tr>
                                        <td>${saleDate.toLocaleString('ko-KR')}</td>
                                        <td>${sale.buyer}</td>
                                        <td>${sale.courseName}</td>
                                        <td style="font-weight: bold; color: var(--primary);">${sale.amount.toLocaleString()}ì›</td>
                                        <td><span class="badge badge-success">ì™„ë£Œ</span></td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                `;
            } catch (error) {
                console.error('Error loading sales:', error);
                document.getElementById('salesList').innerHTML = '<p style="color: var(--danger); padding: 20px; text-align: center;">ë§¤ì¶œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }

        async function loadCourses() {
            try {
                const courses = await window.firebaseDB.getCourses();
                const list = document.getElementById('coursesList');

                if (courses.length === 0) {
                    list.innerHTML = '<p style="color: var(--gray); padding: 20px;">ë“±ë¡ëœ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                list.innerHTML = `
                    <div style="overflow-x: auto;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ì œëª©</th>
                                    <th>ì¹´í…Œê³ ë¦¬</th>
                                    <th>ê°€ê²©</th>
                                    <th>ë“±ë¡ì¼</th>
                                    <th>ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${courses.map(course => {
                                    const createdDate = course.createdAt?.toDate ? course.createdAt.toDate() : new Date();
                                    return `
                                        <tr>
                                            <td>${course.image || 'ğŸ“–'} ${course.title}</td>
                                            <td><span class="badge badge-success">${course.category}</span></td>
                                            <td>${course.price === 0 ? 'ë¬´ë£Œ' : course.price.toLocaleString() + 'ì›'}</td>
                                            <td>${createdDate.toLocaleDateString('ko-KR')}</td>
                                            <td>
                                                <button class="btn btn-primary" style="padding: 6px 12px; font-size: 14px; margin-right: 5px;" onclick="editCourse('${course.id}')">ìˆ˜ì •</button>
                                                <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 14px; background: var(--danger);" onclick="deleteCourse('${course.id}')">ì‚­ì œ</button>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading courses:', error);
                document.getElementById('coursesList').innerHTML = '<p style="color: var(--danger); padding: 20px;">ê°•ì˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }

        window.showCourseForm = function(courseId = null) {
            editingCourseId = courseId;
            const modal = document.getElementById('courseModal');
            const title = document.getElementById('courseModalTitle');
            document.getElementById('courseAlert').innerHTML = '';
            
            if (courseId) {
                title.textContent = 'ê°•ì˜ ìˆ˜ì •';
                loadCourseData(courseId);
            } else {
                title.textContent = 'ê°•ì˜ ì¶”ê°€';
                document.getElementById('courseId').value = '';
                document.getElementById('courseTitle').value = '';
                document.getElementById('courseDescription').value = '';
                document.getElementById('coursePrice').value = '0';
                document.getElementById('courseCategory').value = 'ìŠ¹ì¸';
                document.getElementById('courseImage').value = 'ğŸ“–';
                document.getElementById('courseContent').value = '';
            }
            
            modal.classList.add('active');
        };

        async function loadCourseData(courseId) {
            try {
                const course = await window.firebaseDB.getCourse(courseId);
                if (course) {
                    document.getElementById('courseId').value = course.id;
                    document.getElementById('courseTitle').value = course.title;
                    document.getElementById('courseDescription').value = course.description;
                    document.getElementById('coursePrice').value = course.price;
                    document.getElementById('courseCategory').value = course.category;
                    document.getElementById('courseImage').value = course.image || 'ğŸ“–';
                    document.getElementById('courseContent').value = course.content || '';
                }
            } catch (error) {
                console.error('Error loading course:', error);
                alert('ê°•ì˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        window.editCourse = function(id) {
            window.showCourseForm(id);
        };

        window.closeCourseModal = function() {
            document.getElementById('courseModal').classList.remove('active');
            editingCourseId = null;
        };

        window.submitCourse = async function(e) {
            e.preventDefault();
            
            const saveBtn = document.getElementById('courseSaveBtn');
            const alertDiv = document.getElementById('courseAlert');
            saveBtn.disabled = true;
            alertDiv.innerHTML = '';

            try {
                const courseData = {
                    title: document.getElementById('courseTitle').value.trim(),
                    description: document.getElementById('courseDescription').value.trim(),
                    price: parseInt(document.getElementById('coursePrice').value),
                    category: document.getElementById('courseCategory').value,
                    image: document.getElementById('courseImage').value.trim() || 'ğŸ“–',
                    content: document.getElementById('courseContent').value.trim()
                };

                if (editingCourseId) {
                    await window.firebaseDB.updateCourse(editingCourseId, courseData);
                    alertDiv.innerHTML = '<div class="alert alert-success">ê°•ì˜ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
                } else {
                    await window.firebaseDB.addCourse(courseData);
                    alertDiv.innerHTML = '<div class="alert alert-success">ê°•ì˜ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
                }

                setTimeout(() => {
                    window.closeCourseModal();
                    loadCourses();
                }, 1500);
            } catch (error) {
                console.error('Error saving course:', error);
                alertDiv.innerHTML = '<div class="alert alert-error">ê°•ì˜ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
                saveBtn.disabled = false;
            }
        };

        window.deleteCourse = async function(id) {
            if (!confirm('ì •ë§ ì´ ê°•ì˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                await window.firebaseDB.deleteCourse(id);
                alert('ê°•ì˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                await loadCourses();
            } catch (error) {
                console.error('Error deleting course:', error);
                alert('ê°•ì˜ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        };

        async function loadUsers() {
            try {
                const users = await window.firebaseDB.getAllUsers();
                const regularUsers = users.filter(u => u.role !== 'admin');
                const list = document.getElementById('usersList');

                if (regularUsers.length === 0) {
                    list.innerHTML = '<p style="color: var(--gray); padding: 20px;">íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                list.innerHTML = `
                    <div style="overflow-x: auto;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ë‹‰ë„¤ì„</th>
                                    <th>í¬ì¸íŠ¸</th>
                                    <th>ì§ˆë¬¸ê¶Œ</th>
                                    <th>ìˆ˜ê°• ê°•ì˜</th>
                                    <th>ê°€ì…ì¼</th>
                                    <th>ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${regularUsers.map(user => {
                                    const createdDate = user.createdAt?.toDate ? user.createdAt.toDate() : new Date();
                                    return `
                                        <tr>
                                            <td>${user.nickname}</td>
                                            <td>${(user.points || 0).toLocaleString()} P</td>
                                            <td>${user.secretQuestions || 0}ê°œ</td>
                                            <td>${(user.courses || []).length}ê°œ</td>
                                            <td>${createdDate.toLocaleDateString('ko-KR')}</td>
                                            <td>
                                                <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 14px; margin-right: 5px; background: var(--warning);" onclick="suspendUser('${user.id}')">ì •ì§€</button>
                                                <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 14px; background: var(--danger);" onclick="blacklistUser('${user.id}')">ë¸”ë™ë¦¬ìŠ¤íŠ¸</button>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('usersList').innerHTML = '<p style="color: var(--danger); padding: 20px;">íšŒì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }

        window.suspendUser = async function(nickname) {
            if (!confirm(`${nickname} íšŒì›ì„ 30ì¼ê°„ ì •ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            try {
                const suspendUntil = new Date();
                suspendUntil.setDate(suspendUntil.getDate() + 30);
                
                await window.firebaseDB.updateUser(nickname, {
                    suspended: true,
                    suspendedUntil: suspendUntil.toISOString()
                });

                // Give all users 20000 points
                const users = await window.firebaseDB.getAllUsers();
                for (const user of users) {
                    if (user.role !== 'admin') {
                        await window.firebaseDB.updateUser(user.id, {
                            points: (user.points || 0) + 20000
                        });
                    }
                }

                alert(`${nickname} íšŒì›ì´ ì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ëª¨ë“  íšŒì›ì´ 20,000Pë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤.`);
                await loadUsers();
            } catch (error) {
                console.error('Error suspending user:', error);
                alert('íšŒì› ì •ì§€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        };

        window.blacklistUser = async function(nickname) {
            if (!confirm(`${nickname} íšŒì›ì„ ë¸”ë™ë¦¬ìŠ¤íŠ¸ì— ë“±ì¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            try {
                await window.firebaseDB.updateUser(nickname, {
                    blacklisted: true,
                    blacklistedAt: new Date().toISOString()
                });

                alert(`${nickname} íšŒì›ì´ ë¸”ë™ë¦¬ìŠ¤íŠ¸ì— ë“±ì¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                await loadUsers();
            } catch (error) {
                console.error('Error blacklisting user:', error);
                alert('ë¸”ë™ë¦¬ìŠ¤íŠ¸ ë“±ì¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        };

        async function loadBlacklist() {
            try {
                const users = await window.firebaseDB.getAllUsers();
                const blacklisted = users.filter(u => u.blacklisted);
                const list = document.getElementById('blacklistList');

                if (blacklisted.length === 0) {
                    list.innerHTML = '<p style="color: var(--gray); padding: 20px;">ë¸”ë™ë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                list.innerHTML = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ë‹‰ë„¤ì„</th>
                                <th>ë“±ì¬ì¼</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${blacklisted.map(user => `
                                <tr>
                                    <td>${user.nickname}</td>
                                    <td>${new Date(user.blacklistedAt).toLocaleDateString('ko-KR')}</td>
                                    <td>
                                        <button class="btn btn-primary" style="padding: 6px 12px; font-size: 14px;" onclick="unblacklistUser('${user.id}')">í•´ì œ</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } catch (error) {
                console.error('Error loading blacklist:', error);
                document.getElementById('blacklistList').innerHTML = '<p style="color: var(--danger); padding: 20px;">ë¸”ë™ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }

        window.unblacklistUser = async function(nickname) {
            if (!confirm(`${nickname} íšŒì›ì˜ ë¸”ë™ë¦¬ìŠ¤íŠ¸ë¥¼ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            try {
                await window.firebaseDB.updateUser(nickname, {
                    blacklisted: false,
                    blacklistedAt: null
                });

                alert(`${nickname} íšŒì›ì˜ ë¸”ë™ë¦¬ìŠ¤íŠ¸ê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                await loadBlacklist();
            } catch (error) {
                console.error('Error removing from blacklist:', error);
                alert('ë¸”ë™ë¦¬ìŠ¤íŠ¸ í•´ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        };

        async function loadStats() {
            try {
                const users = await window.firebaseDB.getAllUsers();
                const courses = await window.firebaseDB.getCourses();
                const posts = await window.firebaseDB.getPosts();
                const revenues = await window.firebaseDB.getRevenues();

                const stats = document.getElementById('statsContainer');
                stats.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div style="background: var(--light-gray); padding: 20px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 36px; font-weight: bold; color: var(--primary); margin-bottom: 5px;">${users.length - 1}</div>
                            <div style="color: var(--gray);">ì´ íšŒì› ìˆ˜</div>
                        </div>
                        <div style="background: var(--light-gray); padding: 20px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 36px; font-weight: bold; color: var(--primary); margin-bottom: 5px;">${courses.length}</div>
                            <div style="color: var(--gray);">ì´ ê°•ì˜ ìˆ˜</div>
                        </div>
                        <div style="background: var(--light-gray); padding: 20px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 36px; font-weight: bold; color: var(--primary); margin-bottom: 5px;">${posts.length}</div>
                            <div style="color: var(--gray);">ì´ ê²Œì‹œê¸€</div>
                        </div>
                        <div style="background: var(--light-gray); padding: 20px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 36px; font-weight: bold; color: var(--primary); margin-bottom: 5px;">${revenues.length}</div>
                            <div style="color: var(--gray);">ìˆ˜ìµ ì¸ì¦</div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading stats:', error);
                document.getElementById('statsContainer').innerHTML = '<p style="color: var(--danger); padding: 20px;">í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }
    </script>
</body>
                                                                                                                       </html>
