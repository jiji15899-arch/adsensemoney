<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€ - ga100</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="logo" onclick="window.location.href='index.html'" style="cursor:pointer">ga100</h1>
                <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>
                <div class="header-right">
                    <span style="color: var(--primary); font-weight: bold; margin-right: 15px;">ğŸ‘‘ ê´€ë¦¬ì</span>
                </div>
            </div>
        </div>
    </header>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>ga100</h2>
            <button class="close-sidebar" onclick="toggleSidebar()">âœ•</button>
        </div>
        <div class="sidebar-section">
            <button class="auth-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </aside>

    <main class="main-content">
        <div class="container">
            <h2 style="margin-bottom: 30px;">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h2>

            <div class="admin-tabs">
                <button class="admin-tab active" onclick="switchAdminTab('courses')">ê°•ì˜ ê´€ë¦¬</button>
                <button class="admin-tab" onclick="switchAdminTab('users')">íšŒì› ê´€ë¦¬</button>
                <button class="admin-tab" onclick="switchAdminTab('blacklist')">ë¸”ë™ë¦¬ìŠ¤íŠ¸</button>
                <button class="admin-tab" onclick="switchAdminTab('payments')">ê²°ì œ ìŠ¹ì¸</button>
                <button class="admin-tab" onclick="switchAdminTab('stats')">í†µê³„</button>
            </div>

            <!-- Course Management -->
            <div class="admin-content active" id="courses-content">
                <div class="admin-panel">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ê°•ì˜ ëª©ë¡</h3>
                        <button class="btn btn-primary" onclick="showCourseForm()">ê°•ì˜ ì¶”ê°€</button>
                    </div>
                    <div id="coursesList"></div>
                </div>
            </div>

            <!-- User Management -->
            <div class="admin-content" id="users-content">
                <div class="admin-panel">
                    <h3 style="margin-bottom: 20px;">íšŒì› ëª©ë¡</h3>
                    <div id="usersList"></div>
                </div>
            </div>

            <!-- Blacklist -->
            <div class="admin-content" id="blacklist-content">
                <div class="admin-panel">
                    <h3 style="margin-bottom: 20px;">ë¸”ë™ë¦¬ìŠ¤íŠ¸</h3>
                    <div id="blacklistList"></div>
                </div>
            </div>

            <!-- Payments -->
            <div class="admin-content" id="payments-content">
                <div class="admin-panel">
                    <h3 style="margin-bottom: 20px;">ê²°ì œ ìŠ¹ì¸ ëŒ€ê¸°</h3>
                    <p style="color: var(--gray);">ê²°ì œ ìŠ¹ì¸ ê¸°ëŠ¥ì€ ì‹¤ì œ ë°±ì—”ë“œ ì‹œìŠ¤í…œì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
                </div>
            </div>

            <!-- Statistics -->
            <div class="admin-content" id="stats-content">
                <div class="admin-panel">
                    <h3 style="margin-bottom: 20px;">í†µê³„</h3>
                    <div id="statsContainer"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Course Form Modal -->
    <div class="modal" id="courseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="courseModalTitle">ê°•ì˜ ì¶”ê°€</h3>
                <button class="modal-close" onclick="closeCourseModal()">âœ•</button>
            </div>
            <form onsubmit="submitCourse(event)">
                <div class="form-group">
                    <label>ê°•ì˜ ì œëª©</label>
                    <input type="text" id="courseTitle" required>
                </div>
                <div class="form-group">
                    <label>ì„¤ëª…</label>
                    <textarea id="courseDescription" required></textarea>
                </div>
                <div class="form-group">
                    <label>ê°€ê²© (ì›, 0ì€ ë¬´ë£Œ)</label>
                    <input type="number" id="coursePrice" required min="0">
                </div>
                <div class="form-group">
                    <label>ì¹´í…Œê³ ë¦¬</label>
                    <select id="courseCategory" required>
                        <option value="ìŠ¹ì¸">ìŠ¹ì¸</option>
                        <option value="ìˆ˜ìµí™”">ìˆ˜ìµí™”</option>
                        <option value="ìµœì í™”">ìµœì í™”</option>
                        <option value="ê³ ê¸‰">ê³ ê¸‰</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì´ëª¨ì§€ ì•„ì´ì½˜</label>
                    <input type="text" id="courseImage" placeholder="ğŸ“–" maxlength="2">
                </div>
                <div class="form-group">
                    <label>ê°•ì˜ ë‚´ìš©</label>
                    <textarea id="courseContent" required style="min-height: 200px;"></textarea>
                </div>
                <input type="hidden" id="courseId">
                <button type="submit" class="btn btn-primary">ì €ì¥</button>
            </form>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p class="copyright">Â© 2024 ga100. All rights reserved.</p>
        </div>
    </footer>

    <script>
        let currentUser = JSON.parse(localStorage.getItem('currentUser'));

        if (!currentUser || currentUser.role !== 'admin') {
            alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
            window.location.href = 'index.html';
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }

        function switchAdminTab(tab) {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.admin-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + '-content').classList.add('active');
            
            if (tab === 'courses') loadCourses();
            if (tab === 'users') loadUsers();
            if (tab === 'blacklist') loadBlacklist();
            if (tab === 'stats') loadStats();
        }

        function loadCourses() {
            const courses = JSON.parse(localStorage.getItem('courses') || '[]');
            const list = document.getElementById('coursesList');

            if (courses.length === 0) {
                list.innerHTML = '<p style="color: var(--gray); padding: 20px;">ë“±ë¡ëœ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            list.innerHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>ì œëª©</th>
                            <th>ì¹´í…Œê³ ë¦¬</th>
                            <th>ê°€ê²©</th>
                            <th>ë“±ë¡ì¼</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${courses.map(course => `
                            <tr>
                                <td>${course.image} ${course.title}</td>
                                <td><span class="badge badge-success">${course.category}</span></td>
                                <td>${course.price === 0 ? 'ë¬´ë£Œ' : course.price.toLocaleString() + 'ì›'}</td>
                                <td>${new Date(course.createdAt).toLocaleDateString('ko-KR')}</td>
                                <td>
                                    <button class="btn btn-primary" style="padding: 6px 12px; font-size: 14px; margin-right: 5px;" onclick="editCourse(${course.id})">ìˆ˜ì •</button>
                                    <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 14px; background: var(--danger);" onclick="deleteCourse(${course.id})">ì‚­ì œ</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function showCourseForm(courseId = null) {
            const modal = document.getElementById('courseModal');
            const title = document.getElementById('courseModalTitle');
            
            if (courseId) {
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                const course = courses.find(c => c.id === courseId);
                
                if (course) {
                    title.textContent = 'ê°•ì˜ ìˆ˜ì •';
                    document.getElementById('courseId').value = course.id;
                    document.getElementById('courseTitle').value = course.title;
                    document.getElementById('courseDescription').value = course.description;
                    document.getElementById('coursePrice').value = course.price;
                    document.getElementById('courseCategory').value = course.category;
                    document.getElementById('courseImage').value = course.image;
                    document.getElementById('courseContent').value = course.content;
                }
            } else {
                title.textContent = 'ê°•ì˜ ì¶”ê°€';
                document.getElementById('courseId').value = '';
                document.getElementById('courseTitle').value = '';
                document.getElementById('courseDescription').value = '';
                document.getElementById('coursePrice').value = '';
                document.getElementById('courseCategory').value = 'ìŠ¹ì¸';
                document.getElementById('courseImage').value = 'ğŸ“–';
                document.getElementById('courseContent').value = '';
            }
            
            modal.classList.add('active');
        }

        function editCourse(id) {
            showCourseForm(id);
        }

        function closeCourseModal() {
            document.getElementById('courseModal').classList.remove('active');
        }

        function submitCourse(e) {
            e.preventDefault();
            
            let courses = JSON.parse(localStorage.getItem('courses') || '[]');
            const courseId = document.getElementById('courseId').value;
            
            const courseData = {
                title: document.getElementById('courseTitle').value.trim(),
                description: document.getElementById('courseDescription').value.trim(),
                price: parseInt(document.getElementById('coursePrice').value),
                category: document.getElementById('courseCategory').value,
                image: document.getElementById('courseImage').value.trim() || 'ğŸ“–',
                content: document.getElementById('courseContent').value.trim()
            };

            if (courseId) {
                // Update existing course
                const index = courses.findIndex(c => c.id === parseInt(courseId));
                courses[index] = { ...courses[index], ...courseData };
            } else {
                // Add new course
                courses.push({
                    id: Date.now(),
                    ...courseData,
                    createdAt: new Date().toISOString()
                });
            }

            localStorage.setItem('courses', JSON.stringify(courses));
            
            // Update admin's courses
            let users = JSON.parse(localStorage.getItem('users') || '[]');
            const adminIndex = users.findIndex(u => u.role === 'admin');
            if (adminIndex >= 0) {
                users[adminIndex].courses = courses.map(c => c.id);
                localStorage.setItem('users', JSON.stringify(users));
            }

            alert('ê°•ì˜ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            closeCourseModal();
            loadCourses();
        }

        function deleteCourse(id) {
            if (!confirm('ì •ë§ ì´ ê°•ì˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            let courses = JSON.parse(localStorage.getItem('courses') || '[]');
            courses = courses.filter(c => c.id !== id);
            localStorage.setItem('courses', JSON.stringify(courses));
            
            alert('ê°•ì˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            loadCourses();
        }

        function loadUsers() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const regularUsers = users.filter(u => u.role !== 'admin');
            const list = document.getElementById('usersList');

            if (regularUsers.length === 0) {
                list.innerHTML = '<p style="color: var(--gray); padding: 20px;">íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            list.innerHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>ë‹‰ë„¤ì„</th>
                            <th>í¬ì¸íŠ¸</th>
                            <th>ì§ˆë¬¸ê¶Œ</th>
                            <th>ìˆ˜ê°• ê°•ì˜</th>
                            <th>ê°€ì…ì¼</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${regularUsers.map(user => `
                            <tr>
                                <td>${user.nickname}</td>
                                <td>${(user.points || 0).toLocaleString()} P</td>
                                <td>${user.secretQuestions || 0}ê°œ</td>
                                <td>${(user.courses || []).length}ê°œ</td>
                                <td>${new Date(user.createdAt).toLocaleDateString('ko-KR')}</td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 14px; margin-right: 5px; background: var(--warning);" onclick="suspendUser('${user.nickname}')">ì •ì§€</button>
                                    <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 14px; background: var(--danger);" onclick="blacklistUser('${user.nickname}')">ë¸”ë™ë¦¬ìŠ¤íŠ¸</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function suspendUser(nickname) {
            if (!confirm(`${nickname} íšŒì›ì„ 30ì¼ê°„ ì •ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            let users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.nickname === nickname);
            
            const suspendUntil = new Date();
            suspendUntil.setDate(suspendUntil.getDate() + 30);
            
            users[userIndex].suspended = true;
            users[userIndex].suspendedUntil = suspendUntil.toISOString();
            
            localStorage.setItem('users', JSON.stringify(users));
            
            // Give all users 20000 points
            users.forEach(u => {
                if (u.role !== 'admin') {
                    u.points = (u.points || 0) + 20000;
                }
            });
            localStorage.setItem('users', JSON.stringify(users));
            
            alert(`${nickname} íšŒì›ì´ ì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ëª¨ë“  íšŒì›ì´ 20,000Pë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤.`);
            loadUsers();
        }

        function blacklistUser(nickname) {
            if (!confirm(`${nickname} íšŒì›ì„ ë¸”ë™ë¦¬ìŠ¤íŠ¸ì— ë“±ì¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            let users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.nickname === nickname);
            
            users[userIndex].blacklisted = true;
            users[userIndex].blacklistedAt = new Date().toISOString();
            
            localStorage.setItem('users', JSON.stringify(users));
            
            alert(`${nickname} íšŒì›ì´ ë¸”ë™ë¦¬ìŠ¤íŠ¸ì— ë“±ì¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            loadUsers();
        }

        function loadBlacklist() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const blacklisted = users.filter(u => u.blacklisted);
            const list = document.getElementById('blacklistList');

            if (blacklisted.length === 0) {
                list.innerHTML = '<p style="color: var(--gray); padding: 20px;">ë¸”ë™ë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>';
                return;
            }

            list.innerHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>ë‹‰ë„¤ì„</th>
                            <th>ë“±ì¬ì¼</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${blacklisted.map(user => `
                            <tr>
                                <td>${user.nickname}</td>
                                <td>${new Date(user.blacklistedAt).toLocaleDateString('ko-KR')}</td>
                                <td>
                                    <button class="btn btn-primary" style="padding: 6px 12px; font-size: 14px;" onclick="unblacklistUser('${user.nickname}')">í•´ì œ</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function unblacklistUser(nickname) {
            if (!confirm(`${nickname} íšŒì›ì˜ ë¸”ë™ë¦¬ìŠ¤íŠ¸ë¥¼ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            let users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.nickname === nickname);
            
            users[userIndex].blacklisted = false;
            delete users[userIndex].blacklistedAt;
            
            localStorage.setItem('users', JSON.stringify(users));
            
            alert(`${nickname} íšŒì›ì˜ ë¸”ë™ë¦¬ìŠ¤íŠ¸ê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            loadBlacklist();
        }

        function loadStats() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const courses = JSON.parse(localStorage.getItem('courses') || '[]');
            const posts = JSON.parse(localStorage.getItem('posts') || '[]');
            const revenues = JSON.parse(localStorage.getItem('revenues') || '[]');

            const stats = document.getElementById('statsContainer');
            stats.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="background: var(--light-gray); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 36px; font-weight: bold; color: var(--primary); margin-bottom: 5px;">${users.length - 1}</div>
                        <div style="color: var(--gray);">ì´ íšŒì› ìˆ˜</div>
                    </div>
                    <div style="background: var(--light-gray); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 36px; font-weight: bold; color: var(--primary); margin-bottom: 5px;">${courses.length}</div>
                        <div style="color: var(--gray);">ì´ ê°•ì˜ ìˆ˜</div>
                    </div>
                    <div style="background: var(--light-gray); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 36px; font-weight: bold; color: var(--primary); margin-bottom: 5px;">${posts.length}</div>
                        <div style="color: var(--gray);">ì´ ê²Œì‹œê¸€</div>
                    </div>
                    <div style="background: var(--light-gray); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 36px; font-weight: bold; color: var(--primary); margin-bottom: 5px;">${revenues.length}</div>
                        <div style="color: var(--gray);">ìˆ˜ìµ ì¸ì¦</div>
                    </div>
                </div>
            `;
        }

        // Initialize
        loadCourses();
    </script>
</body>
</html>
